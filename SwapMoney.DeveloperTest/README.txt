Re-write ProcessTransaction() method to make it more testable.